<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2018-03-12
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180312" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Falcon - Operationalizing Falcon</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">$( document ).ready( function() { $( '.carousel' ).carousel( { interval: 3500 } ) } );</script>
          
            </head>
        <body class="topBarDisabled">
          
                        
                    
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="images/falcon-logo.png"  alt="Apache Falcon" width="200px" height="45px"/>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="index.html" title="Falcon">
        Falcon</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Operationalizing Falcon</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2018-03-12</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.11</li>
            
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <div class="section">
<h2>Operationalizing Falcon<a name="Operationalizing_Falcon"></a></h2></div>
<div class="section">
<h3>Overview<a name="Overview"></a></h3>
<p>Apache Falcon provides various tools to operationalize Falcon consisting of Alerts for unrecoverable errors, Audits of user actions, Metrics, and Notifications. They are detailed below.</p>
<p>++ Lineage</p>
<p>Currently Lineage has no way to access or restore information about entity instances created during the time lineage was disabled. Information about entities however, is preserved and bootstrapped when lineage is enabled. If you have to reset the graph db then you can delete the graph db files as specified in the startup.properties and restart the falcon. Please note: you will loose all the information about the instances if you delete the graph db.</p></div>
<div class="section">
<h3>Monitoring<a name="Monitoring"></a></h3>
<p>Falcon provides monitoring of various events by capturing metrics of those events. The metric numbers can then be used to monitor performance and health of the Falcon system and the entire processing pipelines.</p>
<p>Falcon also exposes <a class="externalLink" href="https://github.com/thinkaurelius/titan/wiki/Titan-Performance-and-Monitoring">metrics for titandb</a></p>
<p>Users can view the logs of these events in the metric.log file, by default this file is created under ${user.dir}/logs/ directory. Users may also extend the Falcon monitoring framework to send events to systems like Mondemand/lwes by implementingorg.apache.falcon.plugin.MonitoringPlugin interface.</p>
<p>The following events are captured by Falcon for logging the metrics:</p>
<ol style="list-style-type: decimal">
<li>New cluster definitions posted to Falcon (success &amp; failures)</li>
<li>New feed definition posted to Falcon (success &amp; failures)</li>
<li>New process definition posted to Falcon (success &amp; failures)</li>
<li>Process update events (success &amp; failures)</li>
<li>Feed update events (success &amp; failures)</li>
<li>Cluster update events (success &amp; failures)</li>
<li>Process suspend events (success &amp; failures)</li>
<li>Feed suspend events (success &amp; failures)</li>
<li>Process resume events (success &amp; failures)</li>
<li>Feed resume events (success &amp; failures)</li>
<li>Process remove events (success &amp; failures)</li>
<li>Feed remove events (success &amp; failures)</li>
<li>Cluster remove events (success &amp; failures)</li>
<li>Process instance kill events (success &amp; failures)</li>
<li>Process instance re-run events (success &amp; failures)</li>
<li>Process instance generation events</li>
<li>Process instance failure events</li>
<li>Process instance auto-retry events</li>
<li>Process instance retry exhaust events</li>
<li>Feed instance deletion event</li>
<li>Feed instance deletion failure event (no retries)</li>
<li>Feed instance replication event</li>
<li>Feed instance replication failure event</li>
<li>Feed instance replication auto-retry event</li>
<li>Feed instance replication retry exhaust event</li>
<li>Feed instance late arrival event</li>
<li>Feed instance post cut-off arrival event</li>
<li>Process re-run due to late feed event</li>
<li>Transaction rollback failed event</li></ol>
<p>The metric logged for an event has the following properties:</p>
<ol style="list-style-type: decimal">
<li>Action - Name of the event.</li>
<li>Dimensions - A list of name/value pairs of various attributes for a given action.</li>
<li>Status- Status of an action FAILED/SUCCEEDED.</li>
<li>Time-taken - Time taken in nanoseconds for a given action.</li></ol>
<p>An example for an event logged for a submit of a new process definition:</p>
<p>2012-05-04 12:23:34,026 {Action:submit, Dimensions:{entityType=process}, Status: SUCCEEDED, Time-taken:97087000 ns}</p>
<p>Users may parse the metric.log or capture these events from custom monitoring frameworks and can plot various graphs or send alerts according to their requirements.</p></div>
<div class="section">
<h3>Notifications<a name="Notifications"></a></h3>
<p>Falcon has two types of notifications - System and User notifications.</p></div>
<div class="section">
<h4>System notifications<a name="System_notifications"></a></h4>
<p>The System notifications are internally generated and used by Falcon to monitor the Falcon orchestrated workflow jobs. By default, Falcon starts an ActiveMQ embedded JMS server on Falcon machine on port 61616 as a daemon. Alternatively, users can make Falcon to use an existing JMS server instead of starting an embedded instance by doing the following 2 steps:</p>
<p></p>
<ul>
<li>Setting the property broker.url in the startup.properties as below</li></ul>
<div class="source">
<pre>
   *.broker.url=tcp://jms-server-host:61616

</pre></div>
<p></p>
<ul>
<li>Set the system property falcon.embeddedmq to false as below</li></ul>
<div class="source">
<pre>
   &lt;FALCON-INSTALL-DIR&gt;/bin/falcon-start -Dfalcon.embeddedmq=false

</pre></div>
<p>Falcon uses FALCON.ENTITY.TOPIC to publish system notifications. This topic and the Map Message fields are internal and could change between releases.</p></div>
<div class="section">
<h4>User notifications<a name="User_notifications"></a></h4>
<p>Falcon, in addition to the FALCON.ENTITY.TOPIC, also creates a JMS topic for every process/feed that is scheduled in Falcon as part of User notification. To enable User notifications, the broker url and implementation class of the JMS engine need to be specified in the cluster definition associated with the feed/process. Users may register consumers on the required topic to check the availability or status of feed instances. The User notification JMS broker instance can be same as the System notification or different.</p>
<p>The name of the JMS topic is same as the process/feed name. Falcon sends a map message for every feed instance that is created/deleted/replicated/imported/exported to the JMS topic. The JMS Map Message sent to a topic has the following fields:</p>
<p></p>
<ol style="list-style-type: decimal">
<li>cluster - name of the current cluster the feed/process is dependent on.</li>
<li>entityType - type of the entity (feed or process).</li>
<li>entityName - name of the entity.</li>
<li>nominalTime - instance time (or data date).</li>
<li>operation - operation like generate, delete, replicate, import, export.</li>
<li>feedNames - name of the feeds which are generated/replicated/deleted/imported/exported.</li>
<li>feedInstancePaths - comma separated feed instance paths.</li>
<li>workflowId - current workflow-id of the instance.</li>
<li>workflowUser - user who owns the feed instance (i.e partition).</li>
<li>runId - current run-id of the instance.</li>
<li>status - status of the user workflow instance.</li>
<li>timeStamp - current timestamp.</li>
<li>logDir - log dir where lineage can be recorded.</li></ol>
<p>The JMS messages are automatically purged after a certain period (default 3 days) by the Falcon JMS house-keeping service. TTL (Time-to-live) for JMS message can be configured in the Falcon's startup.properties file.</p>
<p>The following example shows how to enable and read user notification by connecting to the JMS broker.</p>
<p>First, specify the JMS broker url in the cluster definition XML as shown below.</p>
<div class="source">
<pre>

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!-- filename : primaryCluster.xml --&gt;
&lt;cluster colo=&quot;USWestOregon&quot; description=&quot;oregonHadoopCluster&quot; name=&quot;primaryCluster&quot; xmlns=&quot;uri:falcon:cluster:0.1&quot;&gt;
    &lt;interfaces&gt;
        ...
        ...
        &lt;interface type=&quot;messaging&quot; endpoint=&quot;tcp://user-jms-broker-host:61616?daemon=true&quot; version=&quot;5.1.6&quot; /&gt;
        ...
    &lt;/interfaces&gt;
&lt;/cluster&gt;


</pre></div>
<p>Next, use a JMS consumer (example below in Java) to read the message from the topic with the name FALCON.&lt;feed-or-process-name&gt;</p>
<div class="source">
<pre>
import org.apache.activemq.ActiveMQConnectionFactory;
import org.apache.activemq.command.ActiveMQMapMessage;
import javax.jms.ConnectionFactory;
import javax.jms.Connection;
import javax.jms.MessageConsumer;
import javax.jms.Topic;
import javax.jms.Session;
import javax.jms.TopicSession;

public class FalconUserJMSClient {
    public static void main(String[] args)throws Exception {
        // Note: specify the JMS broker URL
        String brokerUrl = &quot;tcp://localhost:61616&quot;;

        ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(brokerUrl);
        Connection connection = connectionFactory.createConnection();
        connection.setClientID(&quot;Falcon User JMS Consumer&quot;);
        TopicSession session = (TopicSession) connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
        try {

            // Note: the topic name for the feed will be FALCON.&lt;feed-name&gt;
            Topic falconTopic = session.createTopic(&quot;FALCON.feed-sample&quot;);
            MessageConsumer consumer = session.createConsumer(falconTopic);
            connection.start();
            while (true) {
                ActiveMQMapMessage msg = (ActiveMQMapMessage) consumer.receive();
                System.out.println(&quot;cluster             : &quot; + msg.getString(&quot;cluster&quot;));
                System.out.println(&quot;entityType          : &quot; + msg.getString(&quot;entityType&quot;));
                System.out.println(&quot;entityName          : &quot; + msg.getString(&quot;entityName&quot;));
                System.out.println(&quot;nominalTime         : &quot; + msg.getString(&quot;nominalTime&quot;));
                System.out.println(&quot;operation           : &quot; + msg.getString(&quot;operation&quot;));

                System.out.println(&quot;feedNames           : &quot; + msg.getString(&quot;feedNames&quot;));
                System.out.println(&quot;feedInstancePaths   : &quot; + msg.getString(&quot;feedInstancePaths&quot;));

                System.out.println(&quot;workflowId          : &quot; + msg.getString(&quot;workflowId&quot;));
                System.out.println(&quot;workflowUser        : &quot; + msg.getString(&quot;workflowUser&quot;));
                System.out.println(&quot;runId               : &quot; + msg.getString(&quot;runId&quot;));
                System.out.println(&quot;status              : &quot; + msg.getString(&quot;status&quot;));
                System.out.println(&quot;timeStamp           : &quot; + msg.getString(&quot;timeStamp&quot;));
                System.out.println(&quot;logDir              : &quot; + msg.getString(&quot;logDir&quot;));

                System.out.println(&quot;brokerUrl           : &quot; + msg.getString(&quot;brokerUrl&quot;));
                System.out.println(&quot;brokerImplClass     : &quot; + msg.getString(&quot;brokerImplClass&quot;));
                System.out.println(&quot;logFile             : &quot; + msg.getString(&quot;logFile&quot;));
                System.out.println(&quot;topicName           : &quot; + msg.getString(&quot;topicName&quot;));
                System.out.println(&quot;brokerTTL           : &quot; + msg.getString(&quot;brokerTTL&quot;));
            }
        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}

</pre></div></div>
<div class="section">
<h3>Alerts<a name="Alerts"></a></h3>
<p>Falcon generates two type of alerts:</p>
<p>1. By default it logs unrecoverable errors into a log file Users can view these alerts in the alerts.log file, by default this file is created under ${user.dir}/logs/ directory.</p>
<p>Users may also extend the Falcon Alerting plugin to send events to systems like Nagios, etc. by extending org.apache.falcon.plugin.AlertingPlugin interface.</p>
<p>2. Alerts on <b>SLA misses</b> for feeds and process is detailed in <a href="./EntitySLAAlerting.html">Entity SLA Alerting</a>.</p></div>
<div class="section">
<h3>Audits<a name="Audits"></a></h3>
<p>Falcon audits all user activity and captures them into a log file by default. Users can view these audits in the audit.log file, by default this file is created under ${user.dir}/logs/ directory.</p>
<p>Users may also extend the Falcon Audit plugin to send audits to systems like Apache Argus, etc. by extending org.apache.falcon.plugin.AuditingPlugin interface.</p></div>
<div class="section">
<h3>Metrics Collection In Graphite and Database<a name="Metrics_Collection_In_Graphite_and_Database"></a></h3>
<p>Falcon has support to send process metrics like waiting time ,exection time and number of failures to graphite and falcon db.</p>
<p>For details go through <a href="./MetricCollection.html">Metric Collection</a></p></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
              <div class="row span12">Copyright &copy;                    2013-2018
                        <a href="http://www.apache.org">Apache Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

                          
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
              </p>
        
                </div>
    </footer>
  </body>
</html>
